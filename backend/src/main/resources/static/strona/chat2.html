<!DOCTYPE html>
<html>
<head>
    <title>Chat Room Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.4.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>Chat Room</h2>
<div>
    <input type="text" id="roomId" placeholder="Room ID">
    <input type="text" id="userId" placeholder="Your User ID">
    <button onclick="connect()">Join Room</button>
    <button onclick="disconnect()" disabled>Leave Room</button>
</div>
<div>
    <input type="text" id="message" placeholder="Your Message">
    <button onclick="sendMessage()">Send Message</button>
</div>
<div id="messages"></div>

<script>
    var client = null;

    function connect() {
        var roomId = document.getElementById('roomId').value;
        var userId = document.getElementById('userId').value;
        if (!roomId || !userId) {
            alert('Room ID and User ID are required');
            return;
        }

        var sock = new SockJS('/spring-boot-tutorial');
        client = Stomp.over(sock);
        client.connect({}, function(frame) {
            setConnected(true);
            console.log('Connected: ' + frame);

            client.subscribe('/topic/rooms/' + roomId, function(message) {
                showMessage(JSON.parse(message.body).content);
            });

            // Join the room
            client.send("/app/chat/" + roomId + "/addUser", {}, JSON.stringify({userId: userId}));
        });
    }

    function disconnect() {
        if (client !== null) {
            client.disconnect();
        }
        setConnected(false);
        console.log("Disconnected");
    }

    function sendMessage() {
        var roomId = document.getElementById('roomId').value;
        var userId = document.getElementById('userId').value;
        var messageContent = document.getElementById('message').value;
        if (messageContent && roomId && userId) {
            var chatMessage = {
                content: messageContent,
                userId: userId,
                type: 'CHAT'
            };
            client.send("/app/chat/" + roomId + "/sendMessage", {}, JSON.stringify(chatMessage));
            document.getElementById('message').value = '';
        }
    }

    function showMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');
        messageElement.appendChild(document.createTextNode(message));
        messages.appendChild(messageElement);
    }

    function setConnected(connected) {
        document.getElementById('roomId').disabled = connected;
        document.getElementById('userId').disabled = connected;
        document.querySelector('button[onclick="connect()"]').disabled = connected;
        document.querySelector('button[onclick="disconnect()"]').disabled = !connected;
        if (connected) {
            document.getElementById('messages').innerHTML = '';
        }
    }
</script>
</body>
</html>
